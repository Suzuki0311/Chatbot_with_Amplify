version: 1
frontend:
  phases:
    build:
      commands:
        - echo "Skipping frontend build"
        - mkdir empty_directory
        - echo "This is a dummy file." > empty_directory/dummy.txt
  artifacts:
    baseDirectory: empty_directory
    files:
      - '**/*'
backend:
  phases:
    build:
      commands:
        - amplifyPush --simple
        - docker build -t pictolang-dev .
        - docker tag pictolang-dev:latest 660988641828.dkr.ecr.ap-northeast-1.amazonaws.com/pictolang-dev:latest
        - aws ecr get-login-password --region ap-northeast-1 | docker login --username AWS --password-stdin 660988641828.dkr.ecr.ap-northeast-1.amazonaws.com
        - docker push 660988641828.dkr.ecr.ap-northeast-1.amazonaws.com/pictolang-dev:latest
        - aws lambda update-function-code --function-name chatGPTLineChatBotFunction-dev --image-uri 660988641828.dkr.ecr.ap-northeast-1.amazonaws.com/pictolang-dev:latest --publish
  artifacts:
    baseDirectory: chatbot_with_amplify/build
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/*
  runtime-versions:
    python: 3.8